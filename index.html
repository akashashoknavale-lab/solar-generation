<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Monthly Generation Data</title>

<style>
body {
    font-family: Arial, sans-serif;
    padding: 20px;
    background-color: #f4f4f4;
}
h1 { text-align: center; }
.search-container { text-align: center; margin-bottom: 20px; }
input { padding: 10px; width: 250px; }
button { padding: 10px 20px; background: #4CAF50; color: white; border: none; cursor: pointer; }
table { width: 100%; border-collapse: collapse; margin-top: 20px; }
th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
th { background: #4CAF50; color: white; }
.result { margin-top: 20px; text-align: center; font-size: 18px; }
</style>
</head>

<body>

<h1>Monthly Generation Data</h1>

<div class="search-container">
    <input type="text" id="searchDate" placeholder="Enter date (e.g. 1/1/2026)">
    <button onclick="searchData()">Search</button>
</div>

<div id="resultMessage" class="result"></div>

<table id="dataTable">
<thead>
<tr>
    <th>Date</th>
    <th>Generation</th>
    <th>Average/KWp</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
const sheetURL =
"https://docs.google.com/spreadsheets/d/1ol61rCN9yLUSVHekPz9S5W7yEfWQTTas8-yJtxKf1ys/gviz/tq?tqx=out:csv&sheet=Tab";

let sheetData = [];

fetch(sheetURL)
.then(res => res.text())
.then(csv => {
    const rows = csv.trim().split("\n");
    const tbody = document.querySelector("#dataTable tbody");
    tbody.innerHTML = "";

    rows.slice(1).forEach(row => {
        const cols = row.split(",");

        let rawDate = cols[0].replace(/"/g, "").trim();
        let cleanDate = rawDate.split(" ")[0]; // remove time

        const data = {
            date: cleanDate,          // 1/1/2026
            generation: Number(cols[1])
        };

        sheetData.push(data);

        tbody.innerHTML += `
        <tr>
            <td>${data.date}</td>
            <td>${data.generation}</td>
            <td></td>
        </tr>`;
    });
});

function calculateMonthlyTotal() {
    const selectedMonth = document.getElementById("monthPicker").value;
    if (!selectedMonth) {
        document.getElementById("resultMessage").textContent =
            "Please select a month";
        return;
    }

    let total = 0;

    sheetData.forEach(row => {
        const parts = row.date.split("/"); 
        const month = parts[0].padStart(2, "0");
        const year = parts[2];

        const rowMonth = `${year}-${month}`;

        if (rowMonth === selectedMonth) {
            total += row.generation;
        }
    });

    document.getElementById("resultMessage").textContent =
        `Total generation for ${selectedMonth}: ${total.toFixed(2)} units`;
}
</script>
</body>
</html>
