<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Login | Solar Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    font-family: Arial;
    background:#f2f2f2;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
}
.login-box{
    background:white;
    padding:20px;
    width:300px;
    box-shadow:0 0 10px rgba(0,0,0,0.2);
}
input,button{
    width:100%;
    padding:8px;
    margin-top:10px;
}
button{
    background:#4caf50;
    color:white;
    border:none;
    cursor:pointer;
}
.error{
    color:red;
    font-size:12px;
}
</style>
</head>

<body>

<div class="login-box">
    <h3 style="text-align:center">☀️ Solar Dashboard Login</h3>
    <input id="username" placeholder="Username">
    <input id="password" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <div class="error" id="error"></div>
</div>

<script>
const SHEET_ID = "1Y3cr91xEEQj86B9hXMYdpp6UU1a33-vlrFcWKkLRujg";
const USERS_GID = "0"; // users sheet gid

function login(){
    const u = username.value.trim();
    const p = password.value.trim();

    fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=${USERS_GID}`)
    .then(r=>r.text())
    .then(csv=>{
        const rows = csv.split("\n").map(r=>r.split(",").map(c=>c.replace(/"/g,"").trim()));
        rows.shift(); // remove header

        const user = rows.find(r => r[0] === u && r[1] === p);

        if(!user){
            error.innerText = "Invalid username or password";
            return;
        }

        localStorage.setItem("role", user[2]);
        localStorage.setItem("plants", user[3]);
        localStorage.setItem("user", u);

        window.location.href = "dashboard.html";
    });
}
</script>

</body>
</html>
